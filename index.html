<!DOCTYPE html>
<meta charset="utf-8">
<head>
<style>

body {
  font-family: Arial;
}

.background {
  fill: none;
  pointer-events: all;
}

rect {
  fill: none;
  stroke: white;
}


.feature {
  fill: #ccc;
  cursor: pointer;
}

.feature.active {
  fill: orange;
}

</style>
<link rel="stylesheet" href="style.css"/>  
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://d3js.org/topojson.v1.min.js"></script>
<script type="text/javascript" src="autocomplete.js"></script>

<body>
<script>

var width = 1600,
    height = 400,
    active = d3.select(null);

var svg = d3.select("body").append("svg")
                                    .attr("width", width)
                                    .attr("height", height);
 
svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height)
    .on("click", reset);

var g = svg.append("g")
    .style("stroke-width", "1.5px");

var path = d3.geo.path();


d3.json("seats.json", function(error, data) {
  var gg = g.selectAll("g")
    .data(data)
    .enter()
    .append("g")
    .attr("transform", function(d) { return "translate("+ d.x_axis + "," + d.y_axis + ")"; })
    .attr("align", "center")
    .on("click", clicked);    

  gg.append("rect")
    // .attr("x", function (d) { return d.x_axis; })
    // .attr("y", function (d) { return d.y_axis; })
    .attr("height", function (d) { return d.height; })
    .attr("width", function (d) { return d.width; })
    .attr("id", function(d) { return d.employee.split(" ").join("-"); })
    .attr("class", "feature");
    

  gg.append("text")
    .attr("x", function(d) {return d.width / 2; })
    .attr("y", function(d) { return d.height / 2 + 5; })
    .attr("text-anchor", "middle")
    .attr("fill", "#ffffff")
    .attr("cursor", "pointer")
    .attr("style", "font-size: 10px")
    .text(function(d) { 
      var name = d.employee.split(" "),
          first_name = name[0],
          last_name = name[1];
      return first_name.charAt(0) + last_name.charAt(0); 
    });

  // g.selectAll("rect")
  //   .data(data)
  //   .enter()
  //   .append("rect")
  //   .attr("x", function (d) { return d.x_axis; })
  //   .attr("y", function (d) { return d.y_axis; })
  //   .attr("height", function (d) { return d.height; })
  //   .attr("width", function (d) { return d.width; })
  //   .attr("class", "feature")
  //   .attr("id", function(d) { return d.employee; })
  //   .on("click", clicked);    
  });

function clicked(d) {
  var dis = d3.select(this).select("rect");
  if (active.node() === dis.node()) return reset();
  active.classed("active", false);
  
  console.log(dis); 

  active = dis.classed("active", true);

  zoom(d.width, d.height, d.x_axis, d.y_axis, width, height);
}

function zoom(dwidth, dheight, x_axis, y_axis, width, height) {
  var dx = dwidth,
      dy = dheight,
      x = x_axis + dwidth / 2,
      y = y_axis + dheight / 2

  var scale = .5 / Math.max(dx / width, dy / height),
      translate = [width / 2 - scale * x, height / 2 - scale * y];

  g.transition()
      .duration(750)
      .style("stroke-width", 1.5 / scale + "px")
      .attr("transform", "translate(" + translate + ")scale(" + scale + ")");

}

function reset() {
  active.classed("active", false);
  active = d3.select(null);

  g.transition()
      .duration(750)
      .style("stroke-width", "1.5px")
      .attr("transform", "");
}

//   var rectangles = d3.select("body").selectAll("rect")
//                              .data(data)
//                              .enter()
//                              .append("rect");

//   var rectangleAttributes = rectangles
//                           .attr("x", function (d) { return d.x_axis; })
//                           .attr("y", function (d) { return d.y_axis; })
//                           .attr("height", function (d) { return d.height; })
//                           .attr("width", function (d) { return d.width; });
  
// });


//d3.json("us.json", function(error, us) {
//  svg.append("path")
//      .attr("d", path({
//        type: "MultiPolygon",
//        coordinates: topojson.feature(us, us.objects.states).features
//            .filter(function(d) { return d.geometry && d.geometry.coordinates.length; })
//            .map(function(d) { var b = d3.geo.bounds(d); return [[b[0], [b[0][0], b[1][1]], b[1], [b[1][0], b[0][1]], b[0]]]; })
//      }));
//});

    //Variable to hold autocomplete options
    var keys = [];

    // Load US States as options from CSV - but this can also be created dynamically
    // d3.csv("states.csv",function (csv) {
    //     keys=csv;
    //     console.log(keys);
    //     start();
    // })

    // // Loads employee names as options from JSON
    d3.json("seats.json", function(error, data) {
        for (var i = 0; i < data.length; i++) {
            keys.push(data[i]);
        }
        console.log(keys);
        start();
    });



    //Call back for when user selects an option
    function onSelect(d) {
      
      
      active.classed("active", false);
      // console.log(dis); 

      // active = dis.classed("active", true);

      // if (active.node() === this) return reset();
      // active.classed("active", false);
      // var dis = d3.select(this);
      // console.log(dis);
      // active = d3.select(this).classed("active", true);
      
      var id = "#" + d.employee.split(" ").join("-");
      console.log(d3.select(id));
      active = d3.select(id).classed("active", true);

      // console.log(thisRect);
      zoom(d.width, d.height, d.x_axis, d.y_axis, width, height);
    }

    //Setup and render the autocomplete
    function start() {
        var mc = autocomplete(document.body)
                .keys(keys)
                .dataField("employee")
                .placeHolder("Search Employee - Start typing here")
                .width(960)
                .height(250)
                .onSelected(onSelect)
                .render();
    }

</script>
</head>